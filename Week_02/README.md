学习笔记

GC日志分析

1 SerialGC 

日志文件，

[SerialGC_256m.demo.log](SerialGC_256m.demo.log)， [SerialGC_512m.demo.log](SerialGC_512m.demo.log)， [SerialGC_1g.demo.log](SerialGC_1g.demo.log) ，[SerialGC_2g.demo.log](SerialGC_2g.demo.log) 

SerialGC_256m.demo.log中第一次发生GC日志如下：

2020-10-23T14:55:20.296+0800: 0.453: [GC (Allocation Failure) 2020-10-23T14:55:20.297+0800: 0.454: [DefNew: 33472K->4224K(38080K), 0.0151533 secs] 33472K->10788K(122752K), 0.0155448 secs] [Times: user=0.01 sys=0.00, real=0.02 secs] 

- Allocation Failure：触发GC原因

- 2020-10-23T14:55:20.297+0800: 0.454：触发GC时刻

- DefNew：GC垃圾收集器名称，DefNew表示 年轻代使用的单线程、标记­复制、STW 垃圾收集器 

- 33472K->4224K(38080K)：33472K 表示GC前新生代使用大小，4224K表示 GC后新生代使用，括号中38080K新生   代总大小，可计算出GC回收了 29248K=33472K-4224K,可以看到GC前新生代使用率 87.9%=33472K/38080K，

  GC后新生代使用率 11%=4224K/38080K。0.0151533 secs 表示 GC执行的时间

-  33472K->10788K(122752K), 0.0155448 secs：33472K，表示GC前Java堆总的使用大小，10788K，表示GC前Java堆总的使用大小，122752K,表示Java堆的总大小，可以看到首次GC前，tenured老年代没有对象。GC后堆中老年代新近了6564K=10788K-4224K, 对象计算出老年代使用率 7.75%= 6564K/(122752K-38080K),耗时 0.0155448 secs

- [Times: user=0.01 sys=0.00, real=0.02 secs]：此次GC事件的持续时间，通过三个部分来衡量： user 部分表示所有 GC线程消耗的CPU时间； sys 部分表示系统调用和系统等待事件消耗的时间。 real 则表示应用程序暂停的时间。因为串行垃圾收集器(Serial Garbage Collector)只使用单个线程，所以这里 real = user + system ，0.01秒也就是10毫秒 。

  Full GC 前 一次Full GC日志如下：

  2020-10-23T14:55:20.894+0800: 1.051: [GC (Allocation Failure) 2020-10-23T14:55:20.894+0800: 1.051: [DefNew: 69952K->69952K(78656K), 0.0000416 secs]2020-10-23T14:55:20.894+0800: 1.051: [Tenured: 160865K->174750K(174784K), 0.0538996 secs] 230817K->175156K(253440K), [Metaspace: 2820K->2820K(1056768K)], 0.0541208 secs] [Times: user=0.06 sys=0.00, real=0.05 secs] 

  f分析：2020-10-23T14:55:20.894+0800: 1.051时刻发生了Minor GC 耗时0.0000416 secs，新生代69952K->69952K，没有回收调任何内存。新生代利用率 88.9%=69952K/78656K。并伴有[Tenured: 160865K->174750K(174784K), 0.0538996 secs] 老年代的内存回收，老年代的新进了13885K=174750K- 160865K对象,GC后老年代利用率99.9%=174750K/174784K 将触发了一次 Full GC。Metaspace: 2820K->2820K(1056768K)元空间占用了2820K。

  

  Full GC 日志如下：

  2020-10-23T14:55:20.986+0800: 1.143: [Full GC (Allocation Failure) 2020-10-23T14:55:20.986+0800: 1.143: [Tenured: 174750K->174729K(174784K), 0.0654159 secs] 253000K->175943K(253440K), [Metaspace: 2820K->2820K(1056768K)], 0.0655755 secs] [Times: user=0.06 sys=0.00, real=0.07 secs] 

  分析：从时间来看 上一次GC 14:55:20.894+0800: 1.051，上一次GC耗时0.06，与本次Full GC发生时刻 1.143。

  而且日志中没有出现新生代GC信息，说明本次GC事件没怎么处理年轻代 ，老年代也基本没有回收174750K->174729K，后面还发生了几次GC。

  从程序结束后Heap快照中也可以看到新生代使用率91%,Tenured代 使用率99%。之后的几次GC是系统卡死，一直在GC。

  

| Xmx  | Minor GC(次)/平均耗时 | Major-Full GC（次）/平均耗时 | 平均分配率 | 平均提升速率 |
| ---- | --------------------- | ---------------------------- | ---------- | ------------ |
| 256m | 11/20ms               | 6/50ms                       |            |              |
| 512m | 14/15ms               | 3/50ms                       |            |              |
| 1g   | 3/80ms                | 0                            |            |              |
| 2g   | 1/125ms               | 0                            |            |              |

可以看出随着堆内存的增大，新生代一次GC的时间也基本线性增长。